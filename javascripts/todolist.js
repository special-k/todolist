(function(){var t,e,n,i,o,r,s,u,a={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};glob.Todolist=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.addManager("itemsManager",new n),document.body.append(this.list())}return h(e,t),e}(RT.Stratum),n=function(t){function e(){}return h(e,t),e.prototype.finished=!1,e.prototype.createItem=function(t){var e,n;if(t){for(e=n=1;1e3>=n;e=++n)this.storageItem.get("items").push(new RT.StorageItem({task:t,finished:this.finished},"both"));return this.storageItem.get("statusBar").first().set("count",this.storageItem.get("items").count())}},e.prototype.setAllDone=function(t){var e,n,i,o;for(this.finished=t,o=this.storageItem.get("items").items,n=0,i=o.length;i>n;n++)e=o[n],e.set("finished",t);return localStorage.setItem("todos-redtea",JSON.stringify(this.storageItem.get("items").items.map(function(t){return{task:t.data.task,finished:t.data.finished}})))},e.prototype.setStorageItem=function(t){this.storageItem=t},e}(RT.BaseManager),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("list"),e.prototype.managers=["itemsManager"],e.prototype.itemsManagerLoaded=function(){return this.itemsManager.setStorageItem(this.storageItem)},e.prototype.createDom=function(t){return this.section({id:"todoapp"},function(){return this.h1(function(){return this.tn("todolist")}),this.ul({id:"todo-list"}).setas("listEl",t).append(function(){return this.newItem()}),this.statusBar()})},e.prototype.storageInit=function(){return this.bime(this.getCollectionField("items"),"onItemAdded","onItemAdded")},e.prototype.onItemAdded=function(t,e){return null==e.widget?this.append(function(){return this.item({storageItem:e})}):void 0},e.prototype.append=function(t,e){return this.addHelper(this.listEl,t,e)},e}(RT.Widget),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("item"),e.prototype.collectionName="items",e.prototype.pass="both",e.prototype.createDom=function(t){return this.li(function(){return this.checkbox({name:"finished"}).setas("checkboxEl",t),this.stringField({name:"task"}).setas("stringFieldEl",t),this.textBox({name:"task"}).setas("textBoxEl",t)})},e.prototype.storageInit=function(){return this.bime(this.storageItem,"onFieldChanged","onFieldChanged")},e.prototype.init=function(){return this.viewMode(),this.checkFinished(this.storageItem.get("finished"))},e.prototype.viewMode=function(){return this.stringFieldEl.removeSelf(),this.dom.append(this.textBoxEl,{after:this.checkboxEl})},e.prototype.editMode=function(){return this.textBoxEl.removeSelf(),this.dom.append(this.stringFieldEl,{after:this.checkboxEl})},e.prototype.onFieldChanged=function(t,e,n){return"finished"===e&&this.checkFinished(n),"editing"===e?n?this.editMode():this.viewMode():void 0},e.prototype.checkFinished=function(t){return t?this.addCls("done"):this.remCls("done")},e}(RT.Widget),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("newItem"),e.prototype.collectionName="newItem",e.prototype.managers=["itemsManager"],e.prototype.itemsManagerLoaded=function(){return this.bime(this.stringFieldEl,"onEnter","onEnter")},e.prototype.createDom=function(t){return this.li(function(){return this.checkbox({name:"finished"}).setas("checkboxEl",t),this.stringField({name:"task",placeholder:"\u0427\u0435 \u0434\u0435\u043b\u0430\u0442\u044c-\u0442\u043e, \u0430?"}).setas("stringFieldEl",t)})},e.prototype.init=function(){return this.addCls("newItem"),this.storageItem.set("task","")},e.prototype.onEnter=function(){return this.itemsManager.createItem(this.stringFieldEl.getValue()),this.storageItem.set("task","")},e.prototype.onFieldChanged=function(t,e,n){return"finished"===e?this.itemsManager.setAllDone(n):void 0},e}(e),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("checkbox"),e.prototype.createDom=function(t){return this.input({type:"checkbox","class":"checkbox"})},e.prototype.storageInit=function(){return this.bime(this.storageItem,"onFieldChanged","onFieldChanged")},e.prototype.init=function(t){return this.name=t.name,this.setValue(this.storageItem.get(this.name)),this.bime(this.dom,RTC.CHANGE,"onChange"),this.dom.stopProp(RTC.DBLCLICK)},e.prototype.onFieldChanged=function(t,e,n){return e===this.name?this.setValue(n):void 0},e.prototype.getValue=function(){return this.dom.checked},e.prototype.setValue=function(t){return t?this.dom.checked=!0:this.dom.checked=!1},e.prototype.onChange=function(t,e){return this.storageItem.set(this.name,this.dom.checked)},e}(RT.Widget),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("stringField"),e.prototype.createDom=function(t,e){return this.input({type:"text","class":"stringField",placeholder:e.placeholder||""})},e.prototype.init=function(t){return this.name=t.name,this.setValue(this.storageItem.get(this.name)),this.bime(this.dom,RTC.KEYUP,"onKeyUp"),this.bime(this.dom,RTC.CHANGE,"onChange"),this.bime(this.dom,"blur","setEditing")},e.prototype.storageInit=function(){return this.bime(this.storageItem,"onFieldChanged","onFieldChanged")},e.prototype.onFieldChanged=function(t,e,n){switch(e){case this.name:return this.setValue(n);case"editing":return this.onEditing(n)}},e.prototype.onChange=function(t,e){return this.storageItem.set(this.name,this.getValue())},e.prototype.onKeyUp=function(t,e){return 13===e.keyCode?(this.setEditing(),this.fire("onEnter")):void 0},e.prototype.getValue=function(){return this.dom.value},e.prototype.setValue=function(t){return this.dom.value=t},e.prototype.setEditing=function(){return this.storageItem.set("editing",!1)},e.prototype.onEditing=function(t){return t?(this.dom.focus(),this.dom.setSelectionRange(this.dom.value.length,this.dom.value.length)):void 0},e}(RT.Widget),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("textBox"),e.prototype.createDom=function(t){return this.div({"class":"textBox"},function(){return this.tn("").setas("body",t)})},e.prototype.init=function(t){return this.name=t.name,this.setValue(this.storageItem.get(this.name)),this.bime(this.dom,RTC.DBLCLICK,"setEditing")},e.prototype.storageInit=function(){return this.bime(this.storageItem,"onFieldChanged","onFieldChanged")},e.prototype.onFieldChanged=function(t,e,n){return e===this.name?this.setValue(n):void 0},e.prototype.setValue=function(t){return this.body.nodeValue=t,t},e.prototype.setEditing=function(){return this.storageItem.set("editing",!0)},e}(RT.Widget),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.register("statusBar"),e.prototype.collectionName="statusBar",e.prototype.createDom=function(t){return this.footer({id:"footer"},function(){return this.span({id:"todo-count"},function(){return this.tn("0").setas("todoCountEl",t)})})},e.prototype.storageInit=function(){return this.bime(this.storageItem,"onFieldChanged","onFieldChanged")},e.prototype.onFieldChanged=function(t,e,n){return"count"===e?this.todoCountEl.nodeValue=n:void 0},e}(RT.Widget)}).call(this);
